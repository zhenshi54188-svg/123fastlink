<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>123FastLink - 123äº‘ç›˜ç§’ä¼ JSONç”Ÿæˆå™¨ - æ”¯æŒ123/å¤¸å…‹/å¤©ç¿¼äº‘ç›˜åœ¨çº¿ç§’ä¼ è½¬å­˜å·¥å…·</title>
  <meta name="description" content="123FastLink å…è´¹åœ¨çº¿ç”Ÿæˆ123äº‘ç›˜ã€å¤¸å…‹ç½‘ç›˜ã€å¤©ç¿¼189äº‘ç›˜ç§’ä¼ JSONæ–‡ä»¶ï¼Œæ”¯æŒåŠ å¯†åˆ†äº«é“¾æ¥è§£æï¼Œå¿«é€Ÿè½¬å­˜ç½‘ç›˜èµ„æºåˆ°è‡ªå·±è´¦å·ï¼Œæ— éœ€ä¸‹è½½ä¸Šä¼ ã€‚">
  <meta name="keywords" content="123äº‘ç›˜ç§’ä¼ ,å¤¸å…‹ç½‘ç›˜ç§’ä¼ ,å¤©ç¿¼äº‘ç›˜ç§’ä¼ ,ç½‘ç›˜ç§’ä¼ ,ç§’ä¼ JSON,ç½‘ç›˜è½¬å­˜,123pan,quark,äº‘ç›˜å·¥å…·">
  <meta name="author" content="123FastLink">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://123.kkit.app/">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš¡</text></svg>">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "123FastLink - 123äº‘ç›˜ç§’ä¼ JSONç”Ÿæˆå™¨"
  }
  </script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      min-height: 100vh; padding: 20px; 
    }
    .container { 
      max-width: 900px; margin: 0 auto; background: white; 
      border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); 
      padding: 40px; 
    }
    h1 { color: #333; margin-bottom: 10px; font-size: 28px; }
    .subtitle { color: #666; margin-bottom: 30px; font-size: 14px; }
    .info-box { 
      background: #e7f3ff; border-left: 4px solid #2196F3; 
      padding: 12px 16px; margin-bottom: 20px; border-radius: 4px; 
      font-size: 13px; color: #333; 
    }
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; color: #333; font-weight: 500; font-size: 14px; }
    .label-with-hint { display: flex; justify-content: space-between; align-items: center; }
    .hint { font-size: 12px; color: #999; font-weight: normal; }
    input, textarea, select { 
      width: 100%; padding: 12px; border: 2px solid #e0e0e0; 
      border-radius: 8px; font-size: 14px; font-family: inherit; 
      transition: border-color 0.3s;
    }
    input:focus, textarea:focus, select:focus { outline: none; border-color: #667eea; }
    textarea { resize: vertical; min-height: 120px; }
    select { cursor: pointer; background: white; }
    .detected-info {
      margin-top: 10px; padding: 10px; background: #f0f8ff;
      border-radius: 6px; font-size: 13px; display: none;
    }
    .detected-info.show { display: block; }
    .detected-info .type-badge {
      display: inline-block; padding: 2px 8px; background: #28a745;
      color: white; border-radius: 12px; font-size: 12px; margin-right: 8px;
    }
    button.primary { 
      width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: white; border: none; border-radius: 8px; font-size: 16px; 
      font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
    }
    button.primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4); }
    button.primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .result { 
      margin-top: 20px; padding: 15px; background: #f8f9fa; 
      border-radius: 8px; display: none; 
    }
    .result.show { display: block; }
    .result.error { background: #f8d7da; border-left: 4px solid #dc3545; }
    .result-text { word-break: break-all; color: #333; white-space: pre-wrap; font-family: monospace; font-size: 12px; max-height: 400px; overflow-y: auto; }
    .cookie-saved { display: inline-block; margin-left: 10px; padding: 4px 10px; background: #28a745; color: white; border-radius: 12px; font-size: 12px; font-weight: normal; }
    .clear-cookie { margin-left: 10px; padding: 2px 8px; background: #dc3545; color: white; border: none; border-radius: 4px; font-size: 11px; cursor: pointer; }
    
    .loading-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 9999; display: none; align-items: center; justify-content: center; }
    .loading-modal.show { display: flex; }
    .loading-content { background: white; padding: 30px 40px; border-radius: 12px; min-width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
    .loading-title { font-size: 18px; font-weight: 600; margin-bottom: 15px; }
    .loading-text { font-size: 14px; color: #666; min-height: 20px; }
    .spinner { width: 36px; height: 36px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .progress-container { width: 100%; height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden; margin-top: 15px; }
    .progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.2s; }
    .progress-text { font-size: 13px; color: #666; margin-top: 8px; font-weight: 500; }
    
    .result-dialog-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: none; align-items: center; justify-content: center; }
    .result-dialog-overlay.show { display: flex; }
    .result-dialog { background: white; padding: 30px; border-radius: 12px; width: 80%; max-width: 800px; max-height: 80vh; display: flex; flex-direction: column; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
    .result-dialog-title { font-size: 20px; font-weight: 600; margin-bottom: 15px; }
    .result-dialog-content { flex: 1; overflow: auto; background: #f5f5f5; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 12px; margin-bottom: 20px; }
    .result-dialog-content pre { margin: 0; white-space: pre-wrap; word-wrap: break-word; }
    .result-dialog-actions { display: flex; gap: 10px; justify-content: flex-end; }
    .result-dialog-actions button { padding: 8px 20px; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; transition: opacity 0.2s; }
    .result-dialog-actions button:hover { opacity: 0.85; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>âš¡ 123äº‘ç›˜ç§’ä¼ JSONç”Ÿæˆå™¨</h1>
      <p class="subtitle">æ”¯æŒ 123ç½‘ç›˜ã€å¤¸å…‹ç½‘ç›˜ã€å¤©ç¿¼äº‘ç›˜ - æ™ºèƒ½è¯†åˆ«ç½‘ç›˜ç±»å‹ï¼Œå¿«é€Ÿç”Ÿæˆç§’ä¼ JSON</p>
    </header>
    
    <div class="info-box">
      ğŸ’¡ <strong>ä½¿ç”¨æç¤ºï¼š</strong>ç²˜è´´å®Œæ•´åˆ†äº«æ–‡æœ¬è‡ªåŠ¨è§£æï¼Œæˆ–æ‰‹åŠ¨é€‰æ‹©ç½‘ç›˜ç±»å‹å¹¶å¡«å†™ä¿¡æ¯ã€‚é…åˆ <a href="https://github.com/Bao-qing/123FastLink" target="_blank" rel="noopener noreferrer" style="color: #667eea; text-decoration: underline;">123FastLink</a> å®¢æˆ·ç«¯ä½¿ç”¨æ›´ä½³ã€‚<br>
      è§£æå¤±è´¥ã€åˆ†äº«æ–‡ä»¶è¿‡å¤šã€æ–‡ä»¶æ— æ³•åˆ†äº«æ—¶ï¼Œæ¨èä½¿ç”¨åŠŸèƒ½æ›´å¼ºå¤§çš„ <a href="https://github.com/ekxs0109/123link" target="_blank" rel="noopener noreferrer" style="color: #667eea; text-decoration: underline;">æµè§ˆå™¨è„šæœ¬</a>ã€‚
    </div>

    <main>
      <div class="form-group">
        <label>å¿«é€Ÿè§£æï¼ˆç²˜è´´å®Œæ•´åˆ†äº«æ–‡æœ¬ï¼‰</label>
        <textarea id="share-text" placeholder="ç²˜è´´å®Œæ•´çš„åˆ†äº«æ–‡æœ¬ï¼Œä¾‹å¦‚ï¼š

æˆ‘ç”¨å¤¸å…‹ç½‘ç›˜åˆ†äº«äº†ã€Œæ–‡ä»¶åã€
é“¾æ¥ï¼šhttps://pan.quark.cn/s/xxxxx
æå–ç ï¼šxxxx

æˆ–è€…ç›´æ¥ç²˜è´´é“¾æ¥"></textarea>
        <div id="detected-info" class="detected-info"></div>
      </div>
      <div class="form-group">
        <label>ç½‘ç›˜ç±»å‹</label>
        <select id="pan-type" onchange="onPanTypeChange()">
          <option value="">-- è¯·é€‰æ‹©ç½‘ç›˜ç±»å‹ --</option>
          <option value="123">123ç½‘ç›˜</option>
          <option value="189">189ç½‘ç›˜</option>
          <option value="quark">å¤¸å…‹ç½‘ç›˜</option>
        </select>
      </div>
      <div class="form-group">
        <label>åˆ†äº«é“¾æ¥</label>
        <input type="text" id="share-url" placeholder="ä¾‹å¦‚ï¼šhttps://pan.quark.cn/s/xxxxx">
      </div>
      <div class="form-group">
        <label>æå–ç ï¼ˆé€‰å¡«ï¼‰</label>
        <input type="text" id="share-password" placeholder="å¦‚æœ‰æå–ç è¯·è¾“å…¥">
      </div>
      <div class="form-group" id="cookie-group" style="display:none;">
        <div class="label-with-hint">
          <label>å¤¸å…‹ç½‘ç›˜Cookieï¼ˆå¿…å¡«ï¼‰</label>
          <span id="cookie-saved-badge" class="cookie-saved" style="display:none;">âœ“ å·²ä¿å­˜</span>
        </div>
        <span class="hint">
          <button class="clear-cookie" id="clear-cookie-btn" style="display:none;" onclick="clearCookie()">æ¸…é™¤</button>
          <a href="#" onclick="showCookieHelp(); return false;" style="color: #667eea; text-decoration: none;">å¦‚ä½•è·å–?</a>
        </span>
        <textarea id="quark-cookie" rows="3" placeholder="ç™»å½• https://pan.quark.cnï¼ŒæŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œåœ¨Networkæ ‡ç­¾ä¸­æ‰¾åˆ°ä»»æ„è¯·æ±‚çš„Cookie"></textarea>
      </div>
      <button class="primary" id="generate-btn" onclick="generate()">ç”Ÿæˆç§’ä¼ JSON</button>
      <div id="result" class="result"></div>
    </main>
    
    <footer style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e0e0e0; text-align: center; font-size: 12px; color: #999;">
      <p>å¼€æºé¡¹ç›® <a href="https://github.com/ekxs0109/123fastlink-cf" target="_blank" rel="noopener noreferrer" style="color: #667eea;">GitHub</a></p>
      <p style="margin-top: 8px;">æ”¯æŒ 123äº‘ç›˜ã€å¤¸å…‹ç½‘ç›˜ã€å¤©ç¿¼äº‘ç›˜ç§’ä¼  | å®Œå…¨å…è´¹</p>
    </footer>
  </div>

  <div id="loading-modal" class="loading-modal">
    <div class="loading-content">
      <div class="spinner"></div>
      <div id="loading-title" class="loading-title">æ­£åœ¨å¤„ç†...</div>
      <div id="loading-text" class="loading-text">è¯·ç¨å€™...</div>
      <div class="progress-container">
          <div id="progress-bar" class="progress-bar"></div>
      </div>
      <div id="progress-text" class="progress-text">0%</div>
    </div>
  </div>

  <div id="result-dialog" class="result-dialog-overlay">
    <div class="result-dialog">
      <div id="result-dialog-title" class="result-dialog-title">ç§’ä¼ JSONç”ŸæˆæˆåŠŸ</div>
      <div id="common-path-checkbox-container" style="margin-bottom: 15px;"></div>
      <div class="result-dialog-content"><pre id="result-json-preview"></pre></div>
      <div class="result-dialog-actions">
        <button id="result-copy-btn" style="background: #667eea;">å¤åˆ¶JSON</button>
        <button id="result-download-btn" style="background: #28a745;">ä¸‹è½½æ–‡ä»¶</button>
        <button id="result-close-btn" style="background: #999;">å…³é—­</button>
      </div>
    </div>
  </div>

  <script>
    // --- Utils ---
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => { clearTimeout(timeout); func(...args); };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    function detectPanType(text) {
      try { text = decodeURIComponent(text); } catch (e) { console.log('URL decode failed'); }
      const detections = {
        '123': { urlRegex: /https?:\/\/www\.(123pan\.com|123865\.com|123684\.com|123912\.com|123pan\.cn)\/s\/([a-zA-Z0-9\-]+)/, pwdRegex: /(?:æå–ç |å¯†ç |è®¿é—®ç )[ï¼š:\s]*([a-zA-Z0-9]{4})/, name: '123ç½‘ç›˜' },
        '189': { urlRegex: /https?:\/\/cloud\.189\.cn\/(?:t\/([a-zA-Z0-9]+)|web\/share\?code=([a-zA-Z0-9]+))/, pwdRegex: /(?:æå–ç |è®¿é—®ç )[ï¼š:\s]*([a-zA-Z0-9]+)/, name: '189ç½‘ç›˜' },
        'quark': { urlRegex: /https?:\/\/pan\.quark\.cn\/s\/([a-zA-Z0-9]+)/, pwdRegex: /(?:æå–ç |å¯†ç )[ï¼š:\s]*([a-zA-Z0-9]+)/, name: 'å¤¸å…‹ç½‘ç›˜' }
      };
      for (const [type, config] of Object.entries(detections)) {
        const urlMatch = text.match(config.urlRegex);
        if (urlMatch) {
          let password = (text.match(/[?&]pwd=([a-zA-Z0-9]+)/) || text.match(config.pwdRegex) || [])[1] || '';
          return { type, name: config.name, url: urlMatch[0], password };
        }
      }
      return null;
    }

    // --- UI Handlers ---
    function autoParse() {
      const text = document.getElementById('share-text').value.trim();
      const detectedDiv = document.getElementById('detected-info');
      const detected = detectPanType(text);
      if (detected) {
        document.getElementById('pan-type').value = detected.type;
        document.getElementById('share-url').value = detected.url;
        document.getElementById('share-password').value = detected.password;
        detectedDiv.innerHTML = `<span class="type-badge">âœ“ å·²è¯†åˆ«</span> ${detected.name}`;
        detectedDiv.classList.add('show');
        onPanTypeChange();
      } else {
        detectedDiv.innerHTML = '<span style="color: #dc3545;">âŒ æœªè¯†åˆ«åˆ°æœ‰æ•ˆçš„ç½‘ç›˜é“¾æ¥</span>';
        detectedDiv.classList.add('show');
      }
    }
    function onPanTypeChange() {
      const type = document.getElementById('pan-type').value;
      document.getElementById('cookie-group').style.display = (type === 'quark') ? 'block' : 'none';
      if (type === 'quark') loadSavedCookie();
    }
    function saveCookie(cookie) { localStorage.setItem('quark_cookie', cookie); showCookieSavedBadge(); }
    function loadSavedCookie() {
      const saved = localStorage.getItem('quark_cookie');
      if (saved) { document.getElementById('quark-cookie').value = saved; showCookieSavedBadge(); }
    }
    function showCookieSavedBadge() {
      document.getElementById('cookie-saved-badge').style.display = 'inline-block';
      document.getElementById('clear-cookie-btn').style.display = 'inline-block';
    }
    function clearCookie() {
      if (confirm('ç¡®å®šè¦æ¸…é™¤ä¿å­˜çš„Cookieå—ï¼Ÿ')) {
        localStorage.removeItem('quark_cookie');
        document.getElementById('quark-cookie').value = '';
        document.getElementById('cookie-saved-badge').style.display = 'none';
        document.getElementById('clear-cookie-btn').style.display = 'none';
      }
    }
    function showCookieHelp() { alert('è·å–å¤¸å…‹Cookieæ­¥éª¤ï¼š\n\n1. æ‰“å¼€ pan.quark.cn å¹¶ç™»å½•\n2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·\n3. åˆ‡æ¢åˆ° Network (ç½‘ç»œ) æ ‡ç­¾\n4. åˆ·æ–°é¡µé¢\n5. æ‰¾åˆ°ä»»æ„è¯·æ±‚ï¼Œåœ¨ Request Headers ä¸­æ‰¾åˆ°å¹¶å¤åˆ¶å®Œæ•´çš„ Cookie å€¼'); }

    // --- Modals & Dialogs ---
    function showLoadingModal(title) {
      document.getElementById('loading-title').textContent = title || 'æ­£åœ¨å¤„ç†...';
      document.getElementById('loading-text').textContent = 'è¯·ç¨å€™...';
      document.getElementById('progress-bar').style.width = '0%';
      document.getElementById('progress-text').textContent = '0%';
      document.getElementById('loading-modal').classList.add('show');
    }
    function hideLoadingModal() { document.getElementById('loading-modal').classList.remove('show'); }
    function updateProgress(processed, total, phase) {
        const percent = total > 0 ? Math.min(100, (processed / total) * 100) : 0;
        document.getElementById('loading-title').textContent = `æ­£åœ¨${phase}...`;
        document.getElementById('loading-text').textContent = `å·²å¤„ç† ${processed} / ${total}`;
        document.getElementById('progress-bar').style.width = `${percent}%`;
        document.getElementById('progress-text').textContent = `${percent.toFixed(1)}%`;
    }
    function updateScanProgress(count, phase) {
        document.getElementById('loading-title').textContent = `æ­£åœ¨${phase}...`;
        document.getElementById('loading-text').textContent = `å·²å‘ç° ${count} ä¸ªæ–‡ä»¶`;
        document.getElementById('progress-bar').style.width = '0%';
        document.getElementById('progress-text').textContent = '';
    }
    function showResultDialog(json) {
        let currentJson = { ...json };
        const originalCommonPath = json.commonPath || "";
        const shareTitle = originalCommonPath.replace(/\/$/, '');

        const checkboxContainer = document.getElementById('common-path-checkbox-container');

        if (shareTitle) {
            checkboxContainer.innerHTML = `
                <div style="padding: 10px; background: #f0f7ff; border-radius: 4px;">
                    <label style="display: flex; align-items: center; cursor: pointer; font-size: 14px; color: #333;">
                        <input type="checkbox" id="common-path-checkbox" checked style="margin-right: 8px; width: 16px; height: 16px; cursor: pointer;">
                        <span>è®¾ç½® commonPath ä¸ºåˆ†äº«æ ‡é¢˜: <strong>${shareTitle}</strong></span>
                    </label>
                </div>`;
            
            const checkbox = document.getElementById('common-path-checkbox');
            checkbox.onchange = () => {
                currentJson.commonPath = checkbox.checked ? originalCommonPath : "";
                updateJsonDisplay();
            };
        } else {
            checkboxContainer.innerHTML = '';
        }

        const previewEl = document.getElementById('result-json-preview');
        const updateJsonDisplay = () => {
            const jsonString = JSON.stringify(currentJson, null, 2);
            previewEl.textContent = jsonString;
            return jsonString;
        };

        document.getElementById('result-dialog-title').textContent = `ç”ŸæˆæˆåŠŸ: ${shareTitle || 'æ— æ ‡é¢˜'}`;
        document.getElementById('result-dialog').classList.add('show');
        updateJsonDisplay();

        document.getElementById('result-copy-btn').onclick = () => {
            navigator.clipboard.writeText(updateJsonDisplay());
            showToast('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        };

        document.getElementById('result-download-btn').onclick = () => {
            const blob = new Blob([updateJsonDisplay()], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${shareTitle || '123link'}.json`;
            a.click();
            URL.revokeObjectURL(url);
        };

        document.getElementById('result-close-btn').onclick = () => {
            document.getElementById('result-dialog').classList.remove('show');
        };
    }
    function showResult(el, msg, type) {
      el.className = 'result show ' + type;
      el.innerHTML = `<div class="result-text">${msg}</div>`;
    }
    function showToast(message) {
      const toast = document.createElement("div");
      toast.textContent = message;
      toast.style.cssText = `position:fixed; top:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.75); color:white; padding:10px 20px; border-radius:20px; font-size:14px; z-index:10001; transition:all 0.3s; opacity:0;`;
      document.body.appendChild(toast);
      setTimeout(() => { toast.style.opacity = '1'; toast.style.top = '40px'; }, 10);
      setTimeout(() => { toast.style.opacity = '0'; toast.style.top = '20px'; setTimeout(() => toast.remove(), 300); }, 2500);
    }

    // --- Main Logic ---
    function generate() {
      const panType = document.getElementById('pan-type').value;
      const shareUrl = document.getElementById('share-url').value.trim();
      const sharePassword = document.getElementById('share-password').value.trim();
      const cookie = document.getElementById('quark-cookie').value.trim();
      const btn = document.getElementById('generate-btn');
      const resultEl = document.getElementById('result');
      resultEl.className = 'result';
      
      if (!panType || !shareUrl) return showResult(resultEl, 'è¯·é€‰æ‹©ç½‘ç›˜ç±»å‹å¹¶è¾“å…¥åˆ†äº«é“¾æ¥', 'error');
      if (panType === 'quark' && !cookie) return showResult(resultEl, 'å¤¸å…‹ç½‘ç›˜éœ€è¦æä¾›Cookie', 'error');

      btn.disabled = true;
      btn.textContent = 'ç”Ÿæˆä¸­...';
      showLoadingModal('æ­£åœ¨è¿æ¥...');

      const params = new URLSearchParams({ panType, shareUrl, sharePassword, cookie });
      const es = new EventSource(`/api/stream?${params}`);

      const cleanup = () => {
        es.close();
        btn.disabled = false;
        btn.textContent = 'ç”Ÿæˆç§’ä¼ JSON';
      };

      const recommendation = `<br><br><b>æç¤ºï¼š</b>å¦‚æœç”Ÿæˆå¤±è´¥æˆ–åˆ†äº«æ–‡ä»¶è¿‡å¤šï¼Œæ¨èä½¿ç”¨åŠŸèƒ½æ›´å¼ºå¤§çš„ <a href="https://github.com/ekxs0109/123link" target="_blank" rel="noopener noreferrer" style="color:#667eea">æµè§ˆå™¨è„šæœ¬</a>ã€‚`;

      es.onmessage = function(event) {
        const { type, data } = JSON.parse(event.data);
        switch(type) {
          case 'phase':
            document.getElementById('loading-title').textContent = data.message;
            break;
          case 'scan':
            updateScanProgress(data.count, 'æ‰«ææ–‡ä»¶');
            break;
          case 'progress':
            updateProgress(data.processed, data.total, 'è·å–MD5');
            break;
          case 'result':
            hideLoadingModal();
            showResultDialog(data.rapidTransferJson);
            cleanup();
            break;
          case 'error':
            hideLoadingModal();
            showResult(resultEl, `ç”Ÿæˆå¤±è´¥: ${data.message}${recommendation}`, 'error');
            cleanup();
            break;
        }
      };

      es.onerror = function(err) {
        console.error('EventSource failed:', err);
        hideLoadingModal();
        showResult(resultEl, `è¿æ¥æœåŠ¡å™¨å¤±è´¥æˆ–è¶…æ—¶${recommendation}`, 'error');
        cleanup();
      };
    }

    // --- Init ---
    document.addEventListener('DOMContentLoaded', function() {
      const shareTextArea = document.getElementById('share-text');
      const debouncedAutoParse = debounce(() => { if (shareTextArea.value.trim()) autoParse(); }, 500);
      shareTextArea.addEventListener('input', debouncedAutoParse);
      shareTextArea.addEventListener('paste', () => setTimeout(debouncedAutoParse, 50));
      document.getElementById('quark-cookie').addEventListener('blur', function() { if (this.value.trim()) saveCookie(this.value.trim()); });
    });
  </script>
</body>
</html>